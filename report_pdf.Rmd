---
title: "Projectreport for Machine Learning 2"
header-includes:
  - \usepackage[english]{babel}
  - \DeclareUnicodeCharacter{308}{oe}  
author: "Maluna Menke, Ari (Sara) Wahl, Pavlo Kravets"
date: "`r Sys.Date()`"

output:
  #html_document: 
  pdf_document:
    
    toc: true
    toc_depth: 6
  start-page: 2
---

\pagenumbering{gobble}
\newpage
\pagenumbering{arabic} 
\centering
\raggedright
\newpage

---

```{r setup, include=FALSE}
params <- list(html=knitr::is_html_output())
knitr::opts_chunk$set(echo = params$html)
rm(list = ls(all.names = TRUE)) # reset the environment
source("Setup.R")
```

### 1. Introduction

### 2. The Dataset
\
"The *[Youth Risk Behavior Survey (YRBS)](https://www.cdc.gov/healthyyouth/data/yrbs/data.htm)* measures health-related behaviors and experiences that can lead to death and disability among youth and adults.[...] Some of the health-related behaviors and experiences monitored are:
- Student demographics: sex, sexual identity, race and ethnicity, and grade
- Youth health behaviors and conditions: sexual, injury and violence, bullying, diet and physical activity, obesity, and mental health, including suicide
- Substance use behaviors: electronic vapor product and tobacco product use, alcohol use, and other drug use
- Student experiences: parental monitoring, school connectedness, unstable housing, and exposure to community violence [[1]](#1).
It is a national survey conducted by CDC (Center for Disease Control and Prevention) and includes high school students from both private and public schools within the U.S. Data is collected from 1991 through 2021, we are only using the most recent data from 2021 though. 



```{r categorical variables frequencies, fig.width=10, fig.height=8}



# this can be used to include pictures in the main text: ![](plots/tsne-2000.png)
```
#### 2.1 Preprocessing of the dataset
\

```{r name variables, include=FALSE}

if (!("age" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(age = q1)}

if (!("sex" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(sex = q2)}

if (!("grade" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(grade = q3)}

if (!("height_feet" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(height_feet = q6)}

if (!("weight_pounds" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(weight_pounds = q7)}

if (!("seat_belt" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(seat_belt = q8)}

if (!("drinking_driver_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(drinking_driver_30d = q9)}

if (!("drinking_driving_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(drinking_driving_30d = q10)}

if (!("texting_driving_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(texting_driving_30d = q11)}

if (!("weapon_to_school_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(weapon_to_school_30d = q12)}

if (!("gun_to_school_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(gun_to_school_12m = q13)}

if (!("absence_safety_concerns_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(absence_safety_concerns_30d = q14)}

if (!("weapon_threatened_at_school_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(weapon_threatened_at_school_12m = q15)}

if (!("physical_fight_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(physical_fight_12m = q16)}

if (!("physical_fight_at_school_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(physical_fight_at_school_12m = q17)}

if (!("saw_attack" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(saw_attack = q18)}

if (!("forced_sex" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(forced_sex = q19)}

if (!("sexual_violence_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(sexual_violence_12m = q20)}

if (!("sexual_dating_violence_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(sexual_dating_violence_12m = q21)}

if (!("physical_dating_violence_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(physical_dating_violence_12m = q22)}

if (!("bullied_at_school_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(bullied_at_school_12m = q23)}

if (!("bullied_electronically_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(bullied_electronically_12m = q24)}

if (!("tried_smoking" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(tried_smoking = q30)}

if (!("smoking_age" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(smoking_age = q31)}

if (!("smoking_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(smoking_30d = q32)}

if (!("smoking_perday_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(smoking_perday_30d = q33)}

if (!("vapor_tried" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(vapor_tried = q34)}

if (!("vapor_use_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(vapor_use_30d = q35)}

if (!("vapor_access" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(vapor_access = q36)}

if (!("smokeless_tobacco_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(smokeless_tobacco_30d = q37)}

if (!("cigar_use_30d" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(cigar_use_30d = q38)}

if (!("tried_stop_tobacco_12m" %in% colnames(RISK))) {
  RISK <- RISK%>%
    rename(tried_stop_tobacco_12m = q39)}

```

First, the variables were named instead of encoded with the questions number. 

```{r factorize categoricals, include=FALSE}
# factorize categorical variables:
RISK$age<-factor(RISK$age,ordered = TRUE, labels= c("12orYounger","13","14","15","16","17","18orOlder"))

RISK$raceeth<-factor(RISK$raceeth, labels= c("American/Alaskan Native","Asian", "Black or African American", "Native Pacific Islander", "White", "Hispanic/Latino", "Multiple-Hispanic/Latino", "Multiple-Non-Hispanic/Latino"))

RISK$sex<-factor(RISK$sex, labels= c("female", "male"))

RISK$grade<-factor(RISK$grade,ordered = TRUE, labels= c("9th", "10th", "11th", "12th", "undergraded or other"))

RISK$seat_belt<-factor(RISK$seat_belt,ordered = TRUE, labels= c("Never", "Rarely", "Sometimes", "Mostly", "Always"))

RISK$drinking_driver_30d<-factor(RISK$drinking_driver_30d,ordered = TRUE, labels= c("0", "1", "2 or 3", "4 or 5", "6 or more times"))

RISK$drinking_driving_30d<-factor(RISK$drinking_driving_30d,ordered = TRUE, labels= c("did not drive", "0", "1", "2 or 3", "4 or 5", "6 or more times"))

RISK$texting_driving_30d<-factor(RISK$texting_driving_30d,ordered = TRUE, labels= c("did not drive", "0", "1 or 2", "3 to 5", "6 to 9", "10 to 19", "20 to 29", "all 30 days"))

RISK$weapon_to_school_30d<-factor(RISK$weapon_to_school_30d, ordered = TRUE, labels= c("0", "1", "2 or 3", "4 or 5", "6 or more days"))

RISK$gun_to_school_12m<-factor(RISK$gun_to_school_12m, ordered = TRUE, labels= c("0", "1", "2 or 3", "4 or 5", "6 or more days"))

RISK$absence_safety_concerns_30d<-factor(RISK$absence_safety_concerns_30d, ordered = TRUE, labels= c("0", "1", "2 or 3", "4 or 5", "6 or more days"))

RISK$weapon_threatened_at_school_12m<-factor(RISK$weapon_threatened_at_school_12m, ordered = TRUE, labels= c("0", "1", "2 or 3", "4 or 5", "6 or 7", "8 or 9", "10 or 11", "12 or more times"))

RISK$physical_fight_12m<-factor(RISK$physical_fight_12m, ordered = TRUE, labels= c("0", "1", "2 or 3", "4 or 5", "6 or 7", "8 or 9", "10 or 11", "12 or more times"))

RISK$physical_fight_at_school_12m<-factor(RISK$physical_fight_at_school_12m, ordered = TRUE, labels= c("0", "1", "2 or 3", "4 or 5", "6 or 7", "8 or 9", "10 or 11", "12 or more times"))

RISK$saw_attack<-factor(RISK$saw_attack, labels= c("Yes", "No"))

RISK$forced_sex<-factor(RISK$forced_sex, labels= c("Yes", "No"))

RISK$sexual_violence_12m<-factor(RISK$sexual_violence_12m,ordered = TRUE, labels= c("0", "1", "2 or 3", "4 or 5", "6 or more times"))

RISK$sexual_dating_violence_12m<-factor(RISK$sexual_dating_violence_12m,ordered = TRUE, labels= c("did not date","0", "1", "2 or 3", "4 or 5", "6 or more times"))

RISK$physical_dating_violence_12m<-factor(RISK$physical_dating_violence_12m,ordered = TRUE, labels= c("did not date","0", "1", "2 or 3", "4 or 5", "6 or more times"))

RISK$bullied_at_school_12m<-factor(RISK$bullied_at_school_12m, labels= c("Yes", "No"))

RISK$bullied_electronically_12m<-factor(RISK$bullied_electronically_12m, labels= c("Yes", "No"))

RISK$tried_smoking<-factor(RISK$tried_smoking, labels= c("Yes", "No"))

RISK$smoking_age<-factor(RISK$smoking_age,ordered = TRUE, labels= c("never tried","8 or younger", "9 or 10", "11 or 12", "13 or 14", "15 or 16", "17 or older"))

RISK$smoking_30d<-factor(RISK$smoking_30d,ordered = TRUE, labels= c("0", "1 or 2", "3 to 5", "6 to 9", "10 to 19", "20 to 29", "all 30 days"))

RISK$smoking_perday_30d<-factor(RISK$smoking_perday_30d,ordered = TRUE, labels= c("not smoked", "lass than 1", "1", "2 to 5","6 to 10", "10 to 20", "more than 20 cigarettes"))

RISK$vapor_tried<-factor(RISK$vapor_tried, labels= c("Yes", "No"))

RISK$vapor_use_30d<-factor(RISK$vapor_use_30d, ordered = TRUE, labels= c("0", "1 or 2", "3 to 5", "6 to 9", "10 to 19", "20 to 29", "all 30 days"))

RISK$vapor_access<-factor(RISK$vapor_access, labels= c("not used", "friend or family", "vape/tobacco shop", "store", "kiosk", "internet", "store_stolen", "other"))

RISK$smokeless_tobacco_30d<-factor(RISK$smokeless_tobacco_30d, ordered = TRUE,labels= c("0", "1 or 2", "3 to 5", "6 to 9", "10 to 19", "20 to 29", "all 30 days"))

RISK$cigar_use_30d<-factor(RISK$cigar_use_30d, ordered = TRUE,labels= c("0", "1 or 2", "3 to 5", "6 to 9", "10 to 19", "20 to 29", "all 30 days"))

RISK$tried_stop_tobacco_12m<-factor(RISK$tried_stop_tobacco_12m, labels= c("Did not use", "Yes", "No"))

```

Then, the categorical variables are factorized. For ordninary variables, the factors are ordered as well.



```{r summary, include = FALSE}
# possible summaries of the data:
# summary(RISK) 
# describe(RISK) # more detail
```

```{r check and delete useless variables, include=FALSE}
all(RISK$site==RISK$site[1])
RISK<-RISK %>%select(-site, -orig_rec, -q4,-q5) # delete variable site, orig_rec, q4, q5
# RISK_qn<-RISK_qn %>%select(-site, -orig_rec) 
```

To preprocess the dataset, we first ran a summary on our dataset. The number of NAs seems to depend very much on the question. The variable "orig_rec" only contained NAs and has therefore been removed, as well as the variable "site" which only contained "XX" entries. Variables q4 and q5 are already aggregated in "raceeth" and have also been deleted.
The variable "record" seems to be an ID for the observations. This has to be considered later. 


#### 2.2 Simple Synopsis of the Dataset

```{r study overview, include=FALSE}
str(RISK) # short overview on datatypes etc.
```
\
number of observations:
number of variables:

datatypes:
- nominal variables:
- ordinal variables:
(numeric variables:)
- discrete variables:
- continuous variables:


#### 2.3 Data Imputation

```{r variables overview, include=FALSE}
na_ratio<-sum(is.na(RISK)==TRUE)/(dim(RISK)[1]*dim(RISK)[2])# ratio of NAs among all datapoints
print(na_ratio*100) # % percentage of NAs in data
sum(is.na(RISK)==TRUE) # sum of NAs in dataset
```

#### 2.4 Reducing and balancing the dataset to 2000 observations

#### 2.5 Target Variable
\
As a target variable, we decided to calculate a score from 5 questions that reflects the suicide risk of the person (observation) in question. This score is aggregated with a rule based approach according to the accompanying Data User Guide.[[2]](#2).

### 3. Splitting the Dataset
\
According to the project requirements we split our data in 60% Training, 20% Validation and 20% Testing Data. 

```{r, corr plot, echo=FALSE}

#pairs(RISK) # -> non numeric arguments included
#plot(RISK) 

# corr_mat=cor(RISK, method="s") #create Spearman correlation matrix

#corrplot(corr_mat, method = "color",
#     type = "upper", order = "hclust", 
#     tl.col = "black") 
```





### 4. Machine Learning Models

#### 4.1 Short Mathematical Overview on the used Methods



#### 4.2 Fitting process



#### 4.3 Hyperparameter Optimization



```{r , include=FALSE}

```


```{r print model with stargazer, echo=FALSE}

# stargazer(model, type = "text") # Modell ausgeben mit stargazer
```


\


```{r Signifikanz der Modelle, include= FALSE}
# lrtest(model_best) # erarbeitetes Modell ist besser als Nullmodell?
```

Mithilfe eines Likelihood-Ratio Tests wird überprüft welches Modell das bessere ist.
```{r Vergleich der Modelle, echo=FALSE}

# lrtest(model_best, model) # restringiertes Modell und optimiertes Modell mit mehr IA-Termen

```
Das optimierte Modell ist signifikant besser als das erarbeitete zum festgelegten Signifikanzniveau,
die Nullhypothese des LR-Tests, dass das optimierte Modell nicht besser ist als das komplexere, kann verworfen werden. Wir stellen außerdem fest: Beide Modelle weisen einen signifikanten Erklärungsgehalt auf, sie sind besser als das Nullmodell.

### 5. Comparison of the Models / Model's Performance on Test Data


#### 5.1 Quantitative 

##### 5.1.1 Confusion Matrix

##### 5.1.2 Accuracy

##### 5.1.2 Precision, Recall and F1-Score

#### 5.2 Qualitative


#### 5.3 Overfitting Check

### 6. Visual Representation

### 7. Final Discussion



### 8. References

> <a id="id_1">[1]</a> <https://www.cdc.gov/healthyyouth/data/yrbs/overview.htm>

> <a id="id_2">[2]</a> <https://www.cdc.gov/healthyyouth/data/yrbs/pdf/2021/2021_YRBS_Data_Users_Guide_508.pdf>